---
title: "Introduction to ggplot: Bivariate Plots (and More)"
author: "Peter Freeman"
date: "Summer 2019"
output: 
  slidy_presentation:
    font_adjustment: -1
---

Preliminaries
===

Let's read in a data frame that contains all the locations of Steph Curry's shots during the 2018-19 NBA season:
```{r}
df = read.csv("http://www.stat.cmu.edu/summer/cmsacamp/Week_01_Thursday/curry_2019_shots.csv")
```
These data consist of 1340 rows and 6 columns. To get a quick idea of what the data "look like," we can use base `R`'s `summary()` function:
```{r}
summary(df)
```
The first three variables are quantitative (although discretely valued), the fourth and sixth variables are categorical (binary factor variables), and the fifth variable is also a factor variable that takes on integer values 1 to 5 (with the last presumably indicating overtime).

ggplot: Scatter Plot
===

Let's get a sense of the data by plotting `shot_y` vs. `shot_x` in a scatter plot:
```{r fig.height=5,fig.width=5,fig.align="center"}
library(ggplot2)
ggplot(data=df,mapping=aes(x=shot_x,y=shot_y)) + geom_point(color="red",size=0.5)
```
Not exactly a beautiful Kirk Goldsberry shot chart, but we're getting there...it's only the first week of camp!

Look at the plot: what question would you probably want to ask right away, assuming you know something about basketball?

ggplot: Scatter Plot with Density
===

By using `geom_density_2d()` we can overlay contours that indicate the density of points:
```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=shot_x,y=shot_y)) + geom_density_2d() + geom_point(color="red",size=0.5)
```

ggplot: Scatter Plot with Bins
===

By using `geom_bin2d` we can overlay bins whose color indicates the density of points:
```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=shot_x,y=shot_y)) + geom_bin2d()# + geom_point(color="red",size=0.5)
```

ggplot: Scatter Plot with Hexagonal Bins
===

What about hexagonal bins?
```{r fig.height=5,fig.width=5,fig.align="center"}
if ( require(hexbin) == FALSE ) {
  install.packages("hexbin",repos="https://cloud.r-project.org")
  library(hexbin)
}
ggplot(data=df,mapping=aes(x=shot_x,y=shot_y)) + geom_hex() + geom_point(color="red",size=0.5)
```

Covariance and Correlation
===

Covariance is a measure of the *linear* dependence between two variables. (To be "uncorrelated" is not the same as to be "independent"...the latter means there is no dependence, linear or otherwise, between two variables.) Correlation is a "normalized" form of covariance, that ranges from -1 (one variable linearly decreases absolutely in value while the other increases in value) through 0 (no linear dependence) to 1 (one variable linear increases absolutely while the other increases).

A good package for visualizing correlation is `corrplot`:
```{r}
if ( require(corrplot) == FALSE ) {
  install.packages("corrplot",repos="https://cloud.r-project.org")
  library(corrplot)
}
```

corrplot
===

Here we generate the correlation plot for `shot_x`, `shot_y`, `shot_distance`, and `period`:
```{r fig.height=5,fig.width=5,fig.align="center"}
corrplot(cor(df[,c(1,2,3,5)]),method="ellipse")
```

ggplot: freqpoly
===

`geom_freqpoly()` is a means by which to overlay empirical distributions of data in one plot pane. For instance, what is the distribution of `shot_distance` as a function of `period`?
```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=shot_distance)) + geom_freqpoly(mapping=aes(color=period))
```
Hold up...this didn't work...

Why? Because `period` is not a factor variable. We can fix that on the fly:
```{r}
df$period = factor(df$period)
```

ggplot: freqpoly Redux
===

```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=shot_distance,stat(density))) + geom_freqpoly(mapping=aes(color=period)) +
  xlab("Shot Distance (feet)") + ggtitle("Stephen Curry Shot Distance by Period") + xlim(0,40)
```
Note how I added `stat(density)` to the mapping to make each curve a density estimate (which improves interpretability), along with a couple other bells and whistles.

ggplot: Overlaid Histograms
===

```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=shot_distance,fill=period,stat(density))) + 
  geom_histogram(alpha=0.4,position="Identity") + xlim(0,40)
```
In this case: not particularly helpful. `freqpoly` is better here.

ggplot: Side-By-Side Boxplots
===

```{r fig.height=5,fig.width=5,fig.align="center"}
ggplot(data=df,mapping=aes(x=is_shot_made,y=shot_distance)) + geom_boxplot(fill="FireBrick2") 
```
We can visually infer that made shots are closer to the basket than missed shots.

GGally: pairs plots
===

We step outside canonical `ggplot` plotting for now to bring you a pairs plot from the `GGally` package:
```{r fig.height=7,fig.width=7,fig.align="center"}
if ( require(GGally) == FALSE ) {
  install.packages("GGally",repos="https://cloud.r-project.org")
  library(GGally)
}
ggpairs(df,progress=FALSE,lower=list(combo=wrap("facethist", binwidth=0.8)),color="blue")
```

3D Scatter Plot
===

We conclude by looking at methods for visualizing data in three and more dimensions. The first is via the `scatterplot3d` package:
```{r fig.height=5,fig.width=5,fig.align="center"}
if ( require(scatterplot3d) == FALSE ) {
  install.packages("scatterplot3d",repos="https://cloud.r-project.org")
  library(scatterplot3d)
}
scatterplot3d(x=df$shot_x,y=df$shot_y,z=df$shot_distance,pch=19,color="blue",angle=45)
```

rgl: R Graphics Library
===

Wouldn't it be nice if we could interactively control the 3D scatterplot? Hmmmm...
```{r}
if ( require(rgl) == FALSE ) {
  install.packages("rgl",repos="https://cloud.r-project.org")
  library(rgl)
}
plot3d(x=df$shot_x,y=df$shot_y,z=df$shot_distance,pch=19)
#f = spin3d(axis=c(0,0,1),rpm=5)
#play3d(f,duration=10)
```

Parallel Coordinates
===

The `parcoord()` function in the `MASS` package is one mechanism through which we can attempt to visualize more than three variables at once (although we only visualize three below). Each line in a parallel coordinates plot represents a single object. For instance, in the plot below, we find that there is a dense set of lines that are colored red: these are layups and slam dunks, shots that cluster tightly in all three dimensions.
```{r}
library(MASS)  # this should be in your base distribution
z.color = 64*df$shot_distance/30
palette(rainbow(64))
parcoord(df[,1:3],col=z.color,lwd=0.3)
```